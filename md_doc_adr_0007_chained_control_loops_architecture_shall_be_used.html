<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>servio: 7. Chained control loops architecture shall be used</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">servio
   </div>
   <div id="projectbrief">open source servomotor firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc_adr_0007_chained_control_loops_architecture_shall_be_used.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><ol type="1">
<li>Chained control loops architecture shall be used </li>
</ol>
</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Date: 2023-01-15</p>
<h1><a class="anchor" id="autotoc_md37"></a>
Status</h1>
<p>Child of <a class="el" href="md_doc_adr_0003_stm32g4_is_the_first_platform.html">3. STM32G4 is the first platform</a></p>
<p>Child of <a class="el" href="md_doc_adr_0005_servo_shall_provide_velocity_control.html">5. Servo shall provide velocity control</a></p>
<p>Child of <a class="el" href="md_doc_adr_0006_servo_shall_provide_current_control.html">6. Servo shall provide current control</a></p>
<p>Superceded by <a class="el" href="md_doc_adr_0011_modular_control_loop_architecture_shall_be_used.html">11. Modular control loop architecture shall be used</a></p>
<h1><a class="anchor" id="autotoc_md38"></a>
Context</h1>
<p>The internal architecture of the servomotor affects the characteristics of the system, and mostly should be clearly defined and understood. This is high-level design principle, does not have to directly reflect the implementation. (That is, any implementation that is practically equivalent to this is considered valid)</p>
<p>For the sake of this ADR, we assume that we can measure position,velocity,current, and that we can control the motor with power percentage as an input. (-100...100%)</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Decision</h1>
<p>Based on previous decisions, we have three main control modes: position, velocity, and current control. All three represent a form of control that, in the end, affects the power value based on current values of sensory input.</p>
<p>There are multiple ways these free control modes can be supported by one system, in our case, we decided to have one control loop and chain those loop:</p>
<div class="fragment"><div class="line">       ┌────────────┐</div>
<div class="line">  rad ─┤POSITION    │</div>
<div class="line">       └─────┬──────┘</div>
<div class="line">             │</div>
<div class="line">       ┌─────┴──────┐</div>
<div class="line">rad/s ─┤VELOCITY    │</div>
<div class="line">       └─────┬──────┘</div>
<div class="line">             │</div>
<div class="line">       ┌─────┴──────┐</div>
<div class="line">   A  ─┤CURRENT     │</div>
<div class="line">       └─────┬──────┘</div>
<div class="line">             │</div>
<div class="line">            PWR</div>
</div><!-- fragment --><p>That is, position/velocity control loops does not directly control the motor, but rather different control loop that in consequence controls the motor:</p><ul>
<li>velocity control regulates current to the motor via control loop to achieve desired velocity</li>
<li>position control regulates velocity via velocity loop to achieve desired position</li>
</ul>
<p>For this concept, we shall use the terminology of upstream loop and downstream loop: Upstream loop controls the downstream loop to create the desired effect, directly or undirectly.</p>
<p>The usage of control loops also implies that we have three separate loops that have to be tuned up.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Consequences</h1>
<p>The positive outcome of this architecture should be following property:</p>
<p>If downstream control loop is properly tuned up, tuning the upstream loop should be simpler.</p>
<p>This is key motivation for this architecture, step by step tuning of the current loop, followed by velocity loop, followed by position loop, should result in more stable system, than having independent loops.</p>
<p>The downside is, that if problem manifets in wokr with upstream loop, it might not be immediatly obvious where the problem is: is the upstream loop tuned incorrectly, or is one of the downstream loops incorrectly tunned? In a way that did not manifested in downstream tests? </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jan 15 2024 21:46:10 for servio by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
