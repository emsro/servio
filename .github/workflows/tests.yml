name: tests

on: [push]

jobs:
    test:
        runs-on: ubuntu-latest
        container:
            image: ghcr.io/emsro/build-env:latest
            credentials:
                username: ${{ github.actor }}
                password: ${{ secrets.github_token }}

        defaults:
            run:
                shell:
                    bash
        steps:
            - uses: actions/checkout@v3

            - run: git config --global --add safe.directory /__w/servio/servio

            - run: make build

            - run: make test

            - run: make test SANITIZER=address

            - run: make test SANITIZER=undefined
